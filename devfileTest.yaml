schemaVersion: 2.0.0
metadata:
  name: aws-universal
  version: 1.0.1
  displayName: AWS Universal
  description: Stack with AWS Universal Tooling
  tags: ["aws", "al2"]
  projectType: "aws"
components:
  - name: aws-runtime
    container:
      image: "public.ecr.aws/aws-mde/universal-image:0.2"
      mountSources: true
      volumeMounts:
        - name: docker-store
          path: /var/lib/docker
  - name: docker-store
    volume:
      size: 16Gi
commands:
  - id: testcommand
    exec:
      component: test
      commandLine: "chmod +x script.sh"
      workingDir: /projects/devfiles
  - id: testcommand2
    exec:
      component: test
      commandLine: "./projects/devfiles/script.sh"
  - id: yum
    exec:
      component: test
      commandLine: "yum -y update --security"
  - id: yum2
    exec:
      component: test
      commandLine: "printenv | grep -m 1 AWS_REGION | grep -Eo \"[a-z0-9-]*\" | tee /etc/yum/vars/awsregion"
events:
  postStart:
    - testcommand
    - testcommand2
    - yum
    - yum2
